{"ast":null,"code":"import _regeneratorRuntime from\"E:/SEM 4/MERN/end_sem_project/SocialEcho-main/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"E:/SEM 4/MERN/end_sem_project/SocialEcho-main/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"E:/SEM 4/MERN/end_sem_project/SocialEcho-main/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{memo,useEffect,useMemo,useState}from\"react\";import{useSelector,useDispatch}from\"react-redux\";import{getComPostsAction,clearCommunityPostsAction}from\"../../redux/actions/postActions\";import PostForm from\"../form/PostForm\";import Post from\"../post/Post\";import FollowingUsersPosts from\"./FollowingUsersPosts\";import CommonLoading from\"../loader/CommonLoading\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var MemoizedPost=/*#__PURE__*/memo(Post);var MainSection=function MainSection(){var dispatch=useDispatch();var communityData=useSelector(function(state){var _state$community;return(_state$community=state.community)===null||_state$community===void 0?void 0:_state$community.communityData;});var communityPosts=useSelector(function(state){var _state$posts;return(_state$posts=state.posts)===null||_state$posts===void 0?void 0:_state$posts.communityPosts;});var totalCommunityPosts=useSelector(function(state){var _state$posts2;return(_state$posts2=state.posts)===null||_state$posts2===void 0?void 0:_state$posts2.totalCommunityPosts;});var _useState=useState(\"All posts\"),_useState2=_slicedToArray(_useState,2),activeTab=_useState2[0],setActiveTab=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),isLoading=_useState4[0],setIsLoading=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isLoadMoreLoading=_useState6[0],setIsLoadMoreLoading=_useState6[1];var LIMIT=10;var postError=useSelector(function(state){var _state$posts3;return(_state$posts3=state.posts)===null||_state$posts3===void 0?void 0:_state$posts3.postError;});useEffect(function(){var fetchInitialPosts=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(communityData!==null&&communityData!==void 0&&communityData._id){dispatch(getComPostsAction(communityData._id,LIMIT,0)).finally(function(){setIsLoading(false);});}case 1:case\"end\":return _context.stop();}},_callee);}));return function fetchInitialPosts(){return _ref.apply(this,arguments);};}();fetchInitialPosts();return function(){dispatch(clearCommunityPostsAction());};},[dispatch,communityData]);var handleLoadMore=function handleLoadMore(){if(!isLoadMoreLoading&&communityPosts.length>0&&communityPosts.length<totalCommunityPosts){setIsLoadMoreLoading(true);dispatch(getComPostsAction(communityData._id,LIMIT,communityPosts.length)).finally(function(){setIsLoadMoreLoading(false);});}};var memoizedCommunityPosts=useMemo(function(){return communityPosts===null||communityPosts===void 0?void 0:communityPosts.map(function(post){return/*#__PURE__*/_jsx(MemoizedPost,{post:post},post._id);});},[communityPosts]);if(isLoading||!communityData||!communityPosts){return/*#__PURE__*/_jsx(\"div\",{className:\"main-section flex items-center justify-center h-screen\",children:/*#__PURE__*/_jsx(CommonLoading,{})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col\",children:[/*#__PURE__*/_jsxs(\"ul\",{className:\"flex\",children:[/*#__PURE__*/_jsx(\"li\",{className:\"\".concat(activeTab===\"All posts\"?\"border-blue-500 bg-primary rounded-md text-white\":\"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300\",\" flex-1 cursor-pointer text-center py-2 px-1 border-b-2 font-medium\"),onClick:function onClick(){return setActiveTab(\"All posts\");},children:\"All post\"}),/*#__PURE__*/_jsx(\"li\",{className:\"\".concat(activeTab===\"You're following\"?\"border-blue-500 bg-primary rounded-md text-white\":\"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300\",\" flex-1 cursor-pointer text-center py-2 px-1 border-b-2 font-medium\"),onClick:function onClick(){return setActiveTab(\"You're following\");},children:\"You're following\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 flex flex-col gap-4\",children:[activeTab===\"All posts\"&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"mb-4\",children:/*#__PURE__*/_jsx(PostForm,{communityId:communityData._id,communityName:communityData.name})}),postError&&/*#__PURE__*/_jsx(\"div\",{className:\"text-red-500 bg-red-100 border border-red-500 p-3 rounded-md text-center mx-auto\",children:postError}),/*#__PURE__*/_jsx(\"div\",{children:memoizedCommunityPosts}),communityPosts.length<totalCommunityPosts&&/*#__PURE__*/_jsx(\"button\",{className:\"bg-primary hover:bg-blue-700 text-sm text-white font-semibold rounded-md w-full p-2 my-3\",onClick:handleLoadMore,disabled:isLoadMoreLoading,children:isLoadMoreLoading?\"Loading...\":\"Load More Posts\"})]}),activeTab===\"You're following\"&&/*#__PURE__*/_jsx(FollowingUsersPosts,{communityData:communityData})]})]});};export default MainSection;","map":{"version":3,"names":["memo","useEffect","useMemo","useState","useSelector","useDispatch","getComPostsAction","clearCommunityPostsAction","PostForm","Post","FollowingUsersPosts","CommonLoading","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","MemoizedPost","MainSection","dispatch","communityData","state","_state$community","community","communityPosts","_state$posts","posts","totalCommunityPosts","_state$posts2","_useState","_useState2","_slicedToArray","activeTab","setActiveTab","_useState3","_useState4","isLoading","setIsLoading","_useState5","_useState6","isLoadMoreLoading","setIsLoadMoreLoading","LIMIT","postError","_state$posts3","fetchInitialPosts","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","_id","finally","stop","apply","arguments","handleLoadMore","length","memoizedCommunityPosts","map","post","className","children","concat","onClick","communityId","communityName","name","disabled"],"sources":["E:/SEM 4/MERN/end_sem_project/SocialEcho-main/client/src/components/community/MainSection.jsx"],"sourcesContent":["import { memo, useEffect, useMemo, useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport {\n  getComPostsAction,\n  clearCommunityPostsAction,\n} from \"../../redux/actions/postActions\";\nimport PostForm from \"../form/PostForm\";\nimport Post from \"../post/Post\";\nimport FollowingUsersPosts from \"./FollowingUsersPosts\";\nimport CommonLoading from \"../loader/CommonLoading\";\n\nconst MemoizedPost = memo(Post);\n\nconst MainSection = () => {\n  const dispatch = useDispatch();\n\n  const communityData = useSelector((state) => state.community?.communityData);\n  const communityPosts = useSelector((state) => state.posts?.communityPosts);\n\n  const totalCommunityPosts = useSelector(\n    (state) => state.posts?.totalCommunityPosts\n  );\n\n  const [activeTab, setActiveTab] = useState(\"All posts\");\n  const [isLoading, setIsLoading] = useState(true);\n  const [isLoadMoreLoading, setIsLoadMoreLoading] = useState(false);\n  const LIMIT = 10;\n\n  const postError = useSelector((state) => state.posts?.postError);\n\n  useEffect(() => {\n    const fetchInitialPosts = async () => {\n      if (communityData?._id) {\n        dispatch(getComPostsAction(communityData._id, LIMIT, 0)).finally(() => {\n          setIsLoading(false);\n        });\n      }\n    };\n\n    fetchInitialPosts();\n\n    return () => {\n      dispatch(clearCommunityPostsAction());\n    };\n  }, [dispatch, communityData]);\n\n  const handleLoadMore = () => {\n    if (\n      !isLoadMoreLoading &&\n      communityPosts.length > 0 &&\n      communityPosts.length < totalCommunityPosts\n    ) {\n      setIsLoadMoreLoading(true);\n      dispatch(\n        getComPostsAction(communityData._id, LIMIT, communityPosts.length)\n      ).finally(() => {\n        setIsLoadMoreLoading(false);\n      });\n    }\n  };\n\n  const memoizedCommunityPosts = useMemo(() => {\n    return communityPosts?.map((post) => (\n      <MemoizedPost key={post._id} post={post} />\n    ));\n  }, [communityPosts]);\n\n  if (isLoading || !communityData || !communityPosts) {\n    return (\n      <div className=\"main-section flex items-center justify-center h-screen\">\n        <CommonLoading />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col\">\n      <ul className=\"flex\">\n        <li\n          className={`${\n            activeTab === \"All posts\"\n              ? \"border-blue-500 bg-primary rounded-md text-white\"\n              : \"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300\"\n          } flex-1 cursor-pointer text-center py-2 px-1 border-b-2 font-medium`}\n          onClick={() => setActiveTab(\"All posts\")}\n        >\n          All post\n        </li>\n        <li\n          className={`${\n            activeTab === \"You're following\"\n              ? \"border-blue-500 bg-primary rounded-md text-white\"\n              : \"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300\"\n          } flex-1 cursor-pointer text-center py-2 px-1 border-b-2 font-medium`}\n          onClick={() => setActiveTab(\"You're following\")}\n        >\n          You're following\n        </li>\n      </ul>\n      <div className=\"mt-4 flex flex-col gap-4\">\n        {activeTab === \"All posts\" && (\n          <>\n            <div className=\"mb-4\">\n              <PostForm\n                communityId={communityData._id}\n                communityName={communityData.name}\n              />\n            </div>\n            {postError && (\n              <div className=\"text-red-500 bg-red-100 border border-red-500 p-3 rounded-md text-center mx-auto\">\n                {postError}\n              </div>\n            )}\n\n            <div>{memoizedCommunityPosts}</div>\n            {communityPosts.length < totalCommunityPosts && (\n              <button\n                className=\"bg-primary hover:bg-blue-700 text-sm text-white font-semibold rounded-md w-full p-2 my-3\"\n                onClick={handleLoadMore}\n                disabled={isLoadMoreLoading}\n              >\n                {isLoadMoreLoading ? \"Loading...\" : \"Load More Posts\"}\n              </button>\n            )}\n          </>\n        )}\n        {activeTab === \"You're following\" && (\n          <FollowingUsersPosts communityData={communityData} />\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default MainSection;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}